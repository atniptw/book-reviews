name: Assign Book Review to Copilot

on:
  issues:
    types: [opened, labeled]

jobs:
  assign-to-copilot:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'book-review')
    
    permissions:
      issues: write

    steps:
      - name: Assign issue to Copilot
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            
            // Add a comment with instructions for Copilot
            const instructions = `@copilot Please create a structured markdown file in the \`reviews/\` directory based on this book review.

            **Instructions:**
            1. Parse the book review information from this issue
            2. Improve the grammar and clarity of the review text while preserving the original meaning and tone
            3. Create a markdown file with the following structure:
               - Filename: Use a sanitized version of the book title (lowercase, replace special chars with hyphens)
               - Content:
                 - Book title as header
                 - Author
                 - Rating
                 - Review date
                 - Review text (improved)
                 - What I Liked section (improved)
                 - What I Disliked section (improved)
                 - Additional Notes section (improved)
                 - Link back to this issue
            4. Create the file in the \`reviews/\` directory
            5. Create a pull request with the new review file
            6. Close this issue after the PR is created
            
            Please make the review text polished and professional while keeping the original voice and meaning.`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: instructions
            });
            
            console.log('Instructions posted for Copilot to process the book review.');

